{% extends 'atomic/base.html' %}

{% block title %}Dr. {{ doctor.user.get_full_name }} - MedLynk{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="card shadow-sm mb-4">
        <div class="card-body d-flex flex-column flex-md-row align-items-center gap-4">
            <div class="text-center">
                <div class="rounded-circle overflow-hidden" style="width: 140px; height: 140px; background: #f0f2ff;">
                    {% if doctor.user.profile_picture %}
                    <img src="{{ doctor.user.profile_picture.url }}" alt="Doctor photo" class="img-fluid" style="object-fit: cover; width: 100%; height: 100%;">
                    {% else %}
                    <i class="bi bi-person-badge" style="font-size: 5rem; line-height: 140px; color: #667eea;"></i>
                    {% endif %}
                </div>
            </div>
            <div class="flex-grow-1">
                <h2 class="mb-1">Dr. {{ doctor.user.get_full_name }}</h2>
                <p class="text-muted mb-2">{{ doctor.specialization }}</p>
                <div class="d-flex flex-wrap gap-3 align-items-center">
                    <div>
                        <strong>{{ average_rating|floatformat:1 }}</strong>
                        <small class="text-muted">/ 5.0</small>
                        <small class="text-muted ms-1">({{ rating_count }} reviews)</small>
                    </div>
                    {% if profile and profile.is_available %}
                    <span class="badge bg-success">Available Today</span>
                    {% else %}
                    <span class="badge bg-secondary">Not Available</span>
                    {% endif %}
                    {% if profile and profile.years_of_experience %}
                    <span class="badge bg-info text-dark">{{ profile.years_of_experience }} yrs experience</span>
                    {% endif %}
                </div>
            </div>
            <div>
                <a href="{% url 'appointments:appointment_create' %}?doctor={{ doctor.id }}" class="btn btn-primary">
                    <i class="bi bi-calendar-plus"></i> Book Appointment
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h4 class="mb-3"><i class="bi bi-person-lines-fill"></i> About</h4>
                    <p class="text-muted mb-0">
                        {{ doctor.bio|default:"This doctor has not added a biography yet." }}
                    </p>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h4 class="mb-3"><i class="bi bi-briefcase"></i> Professional Information</h4>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <small class="text-muted text-uppercase">Specialization</small>
                            <p class="mb-0">{{ profile.specialization|default:doctor.specialization }}</p>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted text-uppercase">License Number</small>
                            <p class="mb-0">{{ profile.license_number|default:doctor.license_number|default:"Not provided" }}</p>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted text-uppercase">Consultation Fee</small>
                            <p class="mb-0">â‚±{{ doctor.consultation_fee }}</p>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted text-uppercase">Education</small>
                            <p class="mb-0">{{ profile.education|default:"Not provided" }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <h4 class="mb-4"><i class="bi bi-chat-left-quote"></i> Patient Reviews</h4>
                    {% if ratings %}
                        {% for review in ratings %}
                        <div class="border rounded-3 p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>{{ review.patient.get_full_name }}</strong>
                                <span class="text-warning">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= review.rating %}
                                        <i class="bi bi-star-fill"></i>
                                        {% else %}
                                        <i class="bi bi-star"></i>
                                        {% endif %}
                                    {% endfor %}
                                </span>
                            </div>
                            <p class="mb-0">{{ review.comment|default:"No feedback provided." }}</p>
                            <small class="text-muted">{{ review.created_at|date:"M d, Y" }}</small>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted mb-0">No reviews yet.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="mb-3">Quick Stats</h5>
                    <div class="row text-center g-2">
                        <div class="col-6">
                            <div class="border rounded p-3">
                                <div class="h4 mb-0">{{ profile.years_of_experience|default:"N/A" }}</div>
                                <small class="text-muted">Years Exp.</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-3">
                                <div class="h4 mb-0">{{ total_patients }}</div>
                                <small class="text-muted">Patients</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-3">
                                <div class="h4 mb-0">{{ rating_count }}</div>
                                <small class="text-muted">Reviews</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="border rounded p-3">
                                <div class="h4 mb-0">{{ total_appointments }}</div>
                                <small class="text-muted">Consultations</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <h5 class="mb-3"><i class="bi bi-telephone"></i> Contact Information</h5>
                    <p class="mb-2">
                        <strong>Phone:</strong><br>
                        <span class="text-muted">{{ doctor.user.phone_number|default:"Not provided" }}</span>
                    </p>
                    <p class="mb-0">
                        <strong>Email:</strong><br>
                        <span class="text-muted">{{ doctor.user.email }}</span>
                    </p>
                </div>
            </div>

            <a href="{% url 'doctors:doctor_list' %}" class="btn btn-outline-secondary w-100">
                <i class="bi bi-arrow-left"></i> Back to Doctor List
            </a>
        </div>
    </div>
</div>
{% endblock %}
